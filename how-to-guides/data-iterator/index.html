<!doctype html><html lang=en-us><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-NQNJSZEFB4"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-NQNJSZEFB4',{anonymize_ip:!1})}</script><meta property="og:title" content="How to work with data iterators"><meta property="og:description" content="When the data provider for training or validation is an iterator
(infinite or finite with known or unknown size), here are some basic
examples of how to setup trainer or evaluator."><meta property="og:type" content="article"><meta property="og:url" content="https://pytorch-ignite.ai/how-to-guides/data-iterator/"><meta property="og:image" content="https://pytorch-ignite.ai/images/logos/ignite_logo_feature.png"><meta property="article:section" content="how-to-guides"><meta property="article:published_time" content="2021-08-04T00:00:00+00:00"><meta property="article:modified_time" content="2021-08-06T13:23:16+06:30"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://pytorch-ignite.ai/images/logos/ignite_logo_feature.png"><meta name=twitter:title content="How to work with data iterators"><meta name=twitter:description content="When the data provider for training or validation is an iterator
(infinite or finite with known or unknown size), here are some basic
examples of how to setup trainer or evaluator."><meta name=description content="High-level library to help with training and evaluating neural networks in PyTorch flexibly and transparently."><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#ee4c2c"><title>How to work with data iterators | PyTorch-Ignite</title><link rel=stylesheet type=text/css href=/css/style.min.125203f72a92a60311cb74c041a2ee40c9a6af792496be325e393ab46013c90b.css integrity="sha256-ElID9yqSpgMRy3TAQaLuQMmmr3kklr4yXjk6tGATyQs="><link rel=stylesheet type=text/css href=/css/icons.css><link rel=stylesheet href=/css/custom.min.c8f188c4d411d4bd166d8bb069a1cf75538ea63eb0acc05b8a7ceab44e934224.css><link rel=stylesheet href=/css/sponsors.min.273831ae344a358d21cb7ddb8405ef325fe44a83b83e4d37c971b03189b642b1.css><link rel=stylesheet href=/css/features.min.e0e90cfae6f294d73e9cd004efadaf0185e51575d39356cc5b06d4e24e8cf5f4.css><link rel=icon type=image/svg+xml href=/images/logos/ignite_logomark.svg><link rel=stylesheet href=https://rsms.me/inter/inter.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css><link rel=stylesheet href=/css/tutorials.min.1f22b95d248e6143456ea9c18d5a0bce25e41ff3db05f7c70c090e73e25a2cdf.css></head><body><nav class="navbar is-fresh is-transparent no-shadow" role=navigation aria-label="main navigation"><div class=container><div class=navbar-brand><a class=navbar-item href=/><img src=/images/logos/ignite_logomark.svg alt width=112 height=28></a>
<a class="navbar-item is-hidden-desktop is-hidden-tablet"><div id=menu-icon-wrapper class=menu-icon-wrapper style=visibility:visible><svg width="1e3" height="1e3"><path class="path1" d="M3e2 4e2H7e2c2e2.0 2e2 350-1e2 450A4e2 4e2.0 012e2 2e2L8e2 8e2"/><path class="path2" d="M3e2 5e2H7e2"/><path class="path3" d="M7e2 6e2H3e2c-2e2.0-2e2-4e2 1e2-450A4e2 380 0 112e2 8e2L8e2 2e2"/></svg><button id=menu-icon-trigger class=menu-icon-trigger></button></div></a><a role=button class=navbar-burger aria-label=menu aria-expanded=false data-target=navbar-menu><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><div id=navbar-menu class="navbar-menu is-static"><div class=navbar-start><a class="navbar-item is-hidden-mobile"><div id=menu-icon-wrapper class=menu-icon-wrapper style=visibility:visible><svg width="1e3" height="1e3"><path class="path1" d="M3e2 4e2H7e2c2e2.0 2e2 350-1e2 450A4e2 4e2.0 012e2 2e2L8e2 8e2"/><path class="path2" d="M3e2 5e2H7e2"/><path class="path3" d="M7e2 6e2H3e2c-2e2.0-2e2-4e2 1e2-450A4e2 380 0 112e2 8e2L8e2 2e2"/></svg><button id=menu-icon-trigger class=menu-icon-trigger></button></div></a></div><div class=navbar-end><div class="navbar-item has-dropdown is-hoverable"><a class=navbar-link>Docs</a><div class=navbar-dropdown><a href=/tutorials/ class=navbar-item>Tutorials</a>
<a href=/how-to-guides/ class=navbar-item>How to Guides</a>
<a href=https://pytorch.org/ignite/engine.html class=navbar-item>API Reference</a></div></div><a href=https://github.com/pytorch/ignite class="navbar-item is-secondary">GitHub</a>
<a href=/posts/ class="navbar-item is-secondary">Blog</a>
<a href=/community/ class="navbar-item is-secondary">Community</a></div></div></div></nav><section class="section is-medium has-sidebar"><div class=downloads><a class=colab href=https://colab.research.google.com/github/pytorch-ignite/pytorch-ignite.ai/blob/gh-pages/examples/how-to-guides/data-iterator.ipynb target=_blank rel="noopener noreferrer"><img src=/images/logos/colab.svg alt="Google Colab Logo" width=30 height=30>
<span>Run in Google Colab</span></a>
<a class=notebook href=/examples/how-to-guides/data-iterator.ipynb target=_blank rel="noopener noreferrer" download=data-iterator.ipynb><img src=/images/logos/download.svg alt="Download Logo" width=20 height=20>
<span>Download as Jupyter Notebook</span></a>
<a class=source href=https://github.com/pytorch-ignite/pytorch-ignite.ai/blob/gh-pages/examples/how-to-guides/data-iterator.ipynb target=_blank rel="noopener noreferrer"><img src=/images/logos/github.svg alt="GitHub Logo" width=20 height=20>
<span>View on GitHub</span></a></div><div class="container sidebar-on"><div class=columns><div class="column is-centered-tablet-portrait"><h1 class="title tutorial-title">How to work with data iterators</h1><h5 class="subtitle is-muted is-5"></h5></div></div><div class=tags><span class=tag><a href=/tags/data-iterators/>data iterators</a></span>
<span class=tag><a href=/tags/infinite-iterator/>infinite iterator</a></span>
<span class=tag><a href=/tags/finite-iterator/>finite iterator</a></span></div><div class=content><p>When the data provider for training or validation is an iterator
(infinite or finite with known or unknown size), here are some basic
examples of how to setup trainer or evaluator.</p><h2 id=infinite-iterator-for-training>Infinite iterator for training</h2><p>Letâ€™s use an infinite data iterator as training dataflow</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> torch
<span style=color:#f92672>from</span> ignite.engine <span style=color:#f92672>import</span> Engine, Events

torch<span style=color:#f92672>.</span>manual_seed(<span style=color:#ae81ff>12</span>)

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>infinite_iterator</span>(batch_size):
    <span style=color:#66d9ef>while</span> True:
        batch <span style=color:#f92672>=</span> torch<span style=color:#f92672>.</span>rand(batch_size, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>32</span>, <span style=color:#ae81ff>32</span>)
        <span style=color:#66d9ef>yield</span> batch

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>train_step</span>(trainer, batch):
    <span style=color:#75715e># ...</span>
    s <span style=color:#f92672>=</span> trainer<span style=color:#f92672>.</span>state
    <span style=color:#66d9ef>print</span>(
        f<span style=color:#e6db74>&#34;{s.epoch}/{s.max_epochs} : {s.iteration} - {batch.norm():.3f}&#34;</span>
    )

trainer <span style=color:#f92672>=</span> Engine(train_step)

<span style=color:#75715e># We need to specify epoch_length to define the epoch</span>
trainer<span style=color:#f92672>.</span>run(infinite_iterator(<span style=color:#ae81ff>4</span>), epoch_length<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span>, max_epochs<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>)
</code></pre></td></tr></table></div></div><pre><code>1/3 : 1 - 63.862
1/3 : 2 - 64.042
1/3 : 3 - 63.936
1/3 : 4 - 64.141
1/3 : 5 - 64.767
2/3 : 6 - 63.791
2/3 : 7 - 64.565
2/3 : 8 - 63.602
2/3 : 9 - 63.995
2/3 : 10 - 63.943
3/3 : 11 - 63.831
3/3 : 12 - 64.276
3/3 : 13 - 64.148
3/3 : 14 - 63.920
3/3 : 15 - 64.226





State:
	iteration: 15
	epoch: 3
	epoch_length: 5
	max_epochs: 3
	output: &lt;class 'NoneType'&gt;
	batch: &lt;class 'torch.Tensor'&gt;
	metrics: &lt;class 'dict'&gt;
	dataloader: &lt;class 'generator'&gt;
	seed: &lt;class 'NoneType'&gt;
	times: &lt;class 'dict'&gt;
</code></pre><p>If we do not specify <strong>epoch_length</strong>, we can stop the training explicitly by calling <a href=https://pytorch.org/ignite/generated/ignite.engine.engine.Engine.html#ignite.engine.engine.Engine><code>terminate()</code></a>. In this case, there will be only a single epoch defined.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> torch
<span style=color:#f92672>from</span> ignite.engine <span style=color:#f92672>import</span> Engine, Events

torch<span style=color:#f92672>.</span>manual_seed(<span style=color:#ae81ff>12</span>)

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>infinite_iterator</span>(batch_size):
    <span style=color:#66d9ef>while</span> True:
        batch <span style=color:#f92672>=</span> torch<span style=color:#f92672>.</span>rand(batch_size, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>32</span>, <span style=color:#ae81ff>32</span>)
        <span style=color:#66d9ef>yield</span> batch

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>train_step</span>(trainer, batch):
    <span style=color:#75715e># ...</span>
    s <span style=color:#f92672>=</span> trainer<span style=color:#f92672>.</span>state
    <span style=color:#66d9ef>print</span>(
        f<span style=color:#e6db74>&#34;{s.epoch}/{s.max_epochs} : {s.iteration} - {batch.norm():.3f}&#34;</span>
    )

trainer <span style=color:#f92672>=</span> Engine(train_step)

<span style=color:#a6e22e>@trainer.on</span>(Events<span style=color:#f92672>.</span>ITERATION_COMPLETED(once<span style=color:#f92672>=</span><span style=color:#ae81ff>15</span>))
<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>stop_training</span>():
    trainer<span style=color:#f92672>.</span>terminate()

trainer<span style=color:#f92672>.</span>run(infinite_iterator(<span style=color:#ae81ff>4</span>))
</code></pre></td></tr></table></div></div><pre><code>1/1 : 1 - 63.862
1/1 : 2 - 64.042
1/1 : 3 - 63.936
1/1 : 4 - 64.141
1/1 : 5 - 64.767
1/1 : 6 - 63.791
1/1 : 7 - 64.565
1/1 : 8 - 63.602
1/1 : 9 - 63.995
1/1 : 10 - 63.943
1/1 : 11 - 63.831
1/1 : 12 - 64.276
1/1 : 13 - 64.148
1/1 : 14 - 63.920
1/1 : 15 - 64.226





State:
	iteration: 15
	epoch: 1
	epoch_length: &lt;class 'NoneType'&gt;
	max_epochs: 1
	output: &lt;class 'NoneType'&gt;
	batch: &lt;class 'torch.Tensor'&gt;
	metrics: &lt;class 'dict'&gt;
	dataloader: &lt;class 'generator'&gt;
	seed: &lt;class 'NoneType'&gt;
	times: &lt;class 'dict'&gt;
</code></pre><p>Same code can be used for validating models.</p><h3 id=finite-iterator-with-unknown-length>Finite iterator with unknown length</h3><p>Let&rsquo;s use a finite data iterator but with unknown length (for user). In
case of training, we would like to perform several passes over the
dataflow and thus we need to restart the data iterator when it is
exhausted. In the code, we do not specify <code>epoch_length</code> which will be automatically
determined.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> torch
<span style=color:#f92672>from</span> ignite.engine <span style=color:#f92672>import</span> Engine, Events

torch<span style=color:#f92672>.</span>manual_seed(<span style=color:#ae81ff>12</span>)

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>finite_unk_size_data_iter</span>():
    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>11</span>):
        <span style=color:#66d9ef>yield</span> i

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>train_step</span>(trainer, batch):
    <span style=color:#75715e># ...</span>
    s <span style=color:#f92672>=</span> trainer<span style=color:#f92672>.</span>state
    <span style=color:#66d9ef>print</span>(
        f<span style=color:#e6db74>&#34;{s.epoch}/{s.max_epochs} : {s.iteration} - {batch:.3f}&#34;</span>
    )

trainer <span style=color:#f92672>=</span> Engine(train_step)

<span style=color:#a6e22e>@trainer.on</span>(Events<span style=color:#f92672>.</span>DATALOADER_STOP_ITERATION)
<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>restart_iter</span>():
    trainer<span style=color:#f92672>.</span>state<span style=color:#f92672>.</span>dataloader <span style=color:#f92672>=</span> finite_unk_size_data_iter()

data_iter <span style=color:#f92672>=</span> finite_unk_size_data_iter()
trainer<span style=color:#f92672>.</span>run(data_iter, max_epochs<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span>)
</code></pre></td></tr></table></div></div><pre><code>1/5 : 1 - 0.000
1/5 : 2 - 1.000
1/5 : 3 - 2.000
1/5 : 4 - 3.000
1/5 : 5 - 4.000
1/5 : 6 - 5.000
1/5 : 7 - 6.000
1/5 : 8 - 7.000
1/5 : 9 - 8.000
1/5 : 10 - 9.000
1/5 : 11 - 10.000
2/5 : 12 - 0.000
2/5 : 13 - 1.000
2/5 : 14 - 2.000
2/5 : 15 - 3.000
2/5 : 16 - 4.000
2/5 : 17 - 5.000
2/5 : 18 - 6.000
2/5 : 19 - 7.000
2/5 : 20 - 8.000
2/5 : 21 - 9.000
2/5 : 22 - 10.000
3/5 : 23 - 0.000
3/5 : 24 - 1.000
3/5 : 25 - 2.000
3/5 : 26 - 3.000
3/5 : 27 - 4.000
3/5 : 28 - 5.000
3/5 : 29 - 6.000
3/5 : 30 - 7.000
3/5 : 31 - 8.000
3/5 : 32 - 9.000
3/5 : 33 - 10.000
4/5 : 34 - 0.000
4/5 : 35 - 1.000
4/5 : 36 - 2.000
4/5 : 37 - 3.000
4/5 : 38 - 4.000
4/5 : 39 - 5.000
4/5 : 40 - 6.000
4/5 : 41 - 7.000
4/5 : 42 - 8.000
4/5 : 43 - 9.000
4/5 : 44 - 10.000
5/5 : 45 - 0.000
5/5 : 46 - 1.000
5/5 : 47 - 2.000
5/5 : 48 - 3.000
5/5 : 49 - 4.000
5/5 : 50 - 5.000
5/5 : 51 - 6.000
5/5 : 52 - 7.000
5/5 : 53 - 8.000
5/5 : 54 - 9.000
5/5 : 55 - 10.000





State:
	iteration: 55
	epoch: 5
	epoch_length: 11
	max_epochs: 5
	output: &lt;class 'NoneType'&gt;
	batch: 10
	metrics: &lt;class 'dict'&gt;
	dataloader: &lt;class 'generator'&gt;
	seed: &lt;class 'NoneType'&gt;
	times: &lt;class 'dict'&gt;
</code></pre><p>In case of validation, the code is simply</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> torch
<span style=color:#f92672>from</span> ignite.engine <span style=color:#f92672>import</span> Engine, Events

torch<span style=color:#f92672>.</span>manual_seed(<span style=color:#ae81ff>12</span>)

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>finite_unk_size_data_iter</span>():
    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>11</span>):
        <span style=color:#66d9ef>yield</span> i

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>val_step</span>(evaluator, batch):
    <span style=color:#75715e># ...</span>
    s <span style=color:#f92672>=</span> evaluator<span style=color:#f92672>.</span>state
    <span style=color:#66d9ef>print</span>(
        f<span style=color:#e6db74>&#34;{s.epoch}/{s.max_epochs} : {s.iteration} - {batch:.3f}&#34;</span>
    )

evaluator <span style=color:#f92672>=</span> Engine(val_step)

data_iter <span style=color:#f92672>=</span> finite_unk_size_data_iter()
evaluator<span style=color:#f92672>.</span>run(data_iter)
</code></pre></td></tr></table></div></div><pre><code>1/1 : 1 - 0.000
1/1 : 2 - 1.000
1/1 : 3 - 2.000
1/1 : 4 - 3.000
1/1 : 5 - 4.000
1/1 : 6 - 5.000
1/1 : 7 - 6.000
1/1 : 8 - 7.000
1/1 : 9 - 8.000
1/1 : 10 - 9.000
1/1 : 11 - 10.000





State:
	iteration: 11
	epoch: 1
	epoch_length: 11
	max_epochs: 1
	output: &lt;class 'NoneType'&gt;
	batch: &lt;class 'NoneType'&gt;
	metrics: &lt;class 'dict'&gt;
	dataloader: &lt;class 'generator'&gt;
	seed: &lt;class 'NoneType'&gt;
	times: &lt;class 'dict'&gt;
</code></pre><h3 id=finite-iterator-with-known-length>Finite iterator with known length</h3><p>Let&rsquo;s use a finite data iterator with known size for training or validation. If we need to restart the data iterator, we can do this either as in case of unknown size by attaching the restart handler on <code>@trainer.on(Events.DATALOADER_STOP_ITERATION)</code>, but here we will do this explicitly on iteration:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> torch
<span style=color:#f92672>from</span> ignite.engine <span style=color:#f92672>import</span> Engine, Events

torch<span style=color:#f92672>.</span>manual_seed(<span style=color:#ae81ff>12</span>)

size <span style=color:#f92672>=</span> <span style=color:#ae81ff>11</span>

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>finite_size_data_iter</span>(size):
    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(size):
        <span style=color:#66d9ef>yield</span> i

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>train_step</span>(trainer, batch):
    <span style=color:#75715e># ...</span>
    s <span style=color:#f92672>=</span> trainer<span style=color:#f92672>.</span>state
    <span style=color:#66d9ef>print</span>(
        f<span style=color:#e6db74>&#34;{s.epoch}/{s.max_epochs} : {s.iteration} - {batch:.3f}&#34;</span>
    )

trainer <span style=color:#f92672>=</span> Engine(train_step)

<span style=color:#a6e22e>@trainer.on</span>(Events<span style=color:#f92672>.</span>ITERATION_COMPLETED(every<span style=color:#f92672>=</span>size))
<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>restart_iter</span>():
    trainer<span style=color:#f92672>.</span>state<span style=color:#f92672>.</span>dataloader <span style=color:#f92672>=</span> finite_size_data_iter(size)

data_iter <span style=color:#f92672>=</span> finite_size_data_iter(size)
trainer<span style=color:#f92672>.</span>run(data_iter, max_epochs<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span>)
</code></pre></td></tr></table></div></div><pre><code>1/5 : 1 - 0.000
1/5 : 2 - 1.000
1/5 : 3 - 2.000
1/5 : 4 - 3.000
1/5 : 5 - 4.000
1/5 : 6 - 5.000
1/5 : 7 - 6.000
1/5 : 8 - 7.000
1/5 : 9 - 8.000
1/5 : 10 - 9.000
1/5 : 11 - 10.000
2/5 : 12 - 0.000
2/5 : 13 - 1.000
2/5 : 14 - 2.000
2/5 : 15 - 3.000
2/5 : 16 - 4.000
2/5 : 17 - 5.000
2/5 : 18 - 6.000
2/5 : 19 - 7.000
2/5 : 20 - 8.000
2/5 : 21 - 9.000
2/5 : 22 - 10.000
3/5 : 23 - 0.000
3/5 : 24 - 1.000
3/5 : 25 - 2.000
3/5 : 26 - 3.000
3/5 : 27 - 4.000
3/5 : 28 - 5.000
3/5 : 29 - 6.000
3/5 : 30 - 7.000
3/5 : 31 - 8.000
3/5 : 32 - 9.000
3/5 : 33 - 10.000
4/5 : 34 - 0.000
4/5 : 35 - 1.000
4/5 : 36 - 2.000
4/5 : 37 - 3.000
4/5 : 38 - 4.000
4/5 : 39 - 5.000
4/5 : 40 - 6.000
4/5 : 41 - 7.000
4/5 : 42 - 8.000
4/5 : 43 - 9.000
4/5 : 44 - 10.000
5/5 : 45 - 0.000
5/5 : 46 - 1.000
5/5 : 47 - 2.000
5/5 : 48 - 3.000
5/5 : 49 - 4.000
5/5 : 50 - 5.000
5/5 : 51 - 6.000
5/5 : 52 - 7.000
5/5 : 53 - 8.000
5/5 : 54 - 9.000
5/5 : 55 - 10.000





State:
	iteration: 55
	epoch: 5
	epoch_length: 11
	max_epochs: 5
	output: &lt;class 'NoneType'&gt;
	batch: 10
	metrics: &lt;class 'dict'&gt;
	dataloader: &lt;class 'generator'&gt;
	seed: &lt;class 'NoneType'&gt;
	times: &lt;class 'dict'&gt;
</code></pre><p>In case of validation, the code is simply</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> torch
<span style=color:#f92672>from</span> ignite.engine <span style=color:#f92672>import</span> Engine, Events

torch<span style=color:#f92672>.</span>manual_seed(<span style=color:#ae81ff>12</span>)

size <span style=color:#f92672>=</span> <span style=color:#ae81ff>11</span>

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>finite_size_data_iter</span>(size):
    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(size):
        <span style=color:#66d9ef>yield</span> i

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>val_step</span>(evaluator, batch):
    <span style=color:#75715e># ...</span>
    s <span style=color:#f92672>=</span> evaluator<span style=color:#f92672>.</span>state
    <span style=color:#66d9ef>print</span>(
        f<span style=color:#e6db74>&#34;{s.epoch}/{s.max_epochs} : {s.iteration} - {batch:.3f}&#34;</span>
    )

evaluator <span style=color:#f92672>=</span> Engine(val_step)

data_iter <span style=color:#f92672>=</span> finite_size_data_iter(size)
evaluator<span style=color:#f92672>.</span>run(data_iter)
</code></pre></td></tr></table></div></div><pre><code>1/1 : 1 - 0.000
1/1 : 2 - 1.000
1/1 : 3 - 2.000
1/1 : 4 - 3.000
1/1 : 5 - 4.000
1/1 : 6 - 5.000
1/1 : 7 - 6.000
1/1 : 8 - 7.000
1/1 : 9 - 8.000
1/1 : 10 - 9.000
1/1 : 11 - 10.000





State:
	iteration: 11
	epoch: 1
	epoch_length: 11
	max_epochs: 1
	output: &lt;class 'NoneType'&gt;
	batch: &lt;class 'NoneType'&gt;
	metrics: &lt;class 'dict'&gt;
	dataloader: &lt;class 'generator'&gt;
	seed: &lt;class 'NoneType'&gt;
	times: &lt;class 'dict'&gt;
</code></pre></div><div class=prev-n-next><div class=prev><a href=/how-to-guides/fastai-lr-finder/ class=link><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify icon-prev iconify--carbon" width="32" height="32" viewBox="0 0 32 32"><path d="M14 26l1.41-1.41L7.83 17H28v-2H7.83l7.58-7.59L14 6 4 16l10 10z" fill="currentcolor"/></svg><span class=text>How to use FastaiLRFinder with Ignite</span></a></div><div class=next><a href=/how-to-guides/installation/ class=link><span class=text>How to install PyTorch-Ignite</span><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify icon-next iconify--carbon" width="32" height="32" viewBox="0 0 32 32"><path d="M18 6l-1.43 1.393L24.15 15H4v2h20.15l-7.58 7.573L18 26l10-10L18 6z" fill="currentcolor"/></svg></a></div></div></div></section><div id=backtotop><a href=#></a></div><div class=sidebar><div class=sidebar-header><div class=text>How-to-Guides</div></div><div class=inner><aside><ul><li><a href=/how-to-guides/gradient-accumulation/>How to effectively increase batch size on limited compute</a></li><li><a href=/how-to-guides/installation/>How to install PyTorch-Ignite</a></li><li><a href=/how-to-guides/data-iterator/ class=active>How to work with data iterators</a><nav id=TableOfContents><ul><li><a href=#infinite-iterator-for-training>Infinite iterator for training</a><ul><li><a href=#finite-iterator-with-unknown-length>Finite iterator with unknown length</a></li><li><a href=#finite-iterator-with-known-length>Finite iterator with known length</a></li></ul></li></ul></nav></li><li><a href=/how-to-guides/fastai-lr-finder/>How to use FastaiLRFinder with Ignite</a></li><li><a href=/how-to-guides/time-profiling/>How to do time profiling</a></li></ul></aside></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js></script><script src=https://cdn.jsdelivr.net/npm/feather-icons@4.28.0/dist/feather.min.js></script><script src=/js/modernizr.min.48806575a40ede5e406c8278f3be521afb171e73d324994ced6b41306bdb230a.js></script><script src=/js/fresh.min.29a18383a93b919d639d60aca2437a08bec3ed15276e55dc1cb44a8ddd80bdc6.js></script><script src=/js/active-navbar.min.8067cab2f01a301954f5d28b2cb8cfa1ce10a23ea212f1c734c9b761503d5e0e.js></script><script src=/js/jquery.panelslider.min.js></script><link rel=stylesheet href=/css/copy-code.min.0032417fb3ddf66588bd7871ff6904ecb06695ccb2756f43792bbeec4b7da54f.css><script src=/js/copy-code.min.2597230d83cf7b0549c4a0d22b4e61a1b3fd86eaf05c491aa0b807c7803d9096.js></script><script src=/js/anchor.min.818717ad1ac9e378368b336d69c4a337a826937be38314c67bfca3669727e210.js></script></body></html>